# 超声数据实验数据管理系统 - 产品需求文档 (PRD)

## 文档信息
- **项目名称**: 超声数据实验数据管理系统 (Ultrasonic Data Management System)
- **版本**: v1.0
- **创建日期**: 2025-10-03
- **最后更新**: 2025-10-03
- **负责人**: AI开发团队

## 1. 产品概述

### 1.1 产品定位
超声数据实验数据管理系统是一个面向超声检测实验室和工业检测机构的现代化、高端化数据管理平台。系统专注于超声相控阵检测数据的采集、存储、展示和分析，为检测人员提供专业的数据管理和可视化工具。

### 1.2 核心价值
- **数据集中管理**: 统一管理超声检测实验数据，避免数据分散和丢失
- **专业可视化**: 提供工业级超声图像展示和分析工具
- **标准化流程**: 基于国际标准（ISO 16810, ASTM E2700等）设计检测流程
- **高效协作**: 支持多人协作和数据共享
- **质量追溯**: 完整的数据记录和质量追溯体系

### 1.3 目标用户
- **主要用户**: 无损检测工程师、超声检测技术人员
- **次要用户**: 质量管理人员、实验室管理人员
- **潜在用户**: 研发人员、教育培训机构

## 2. 技术标准参考

### 2.1 国际标准
1. **ISO 16810**: 超声相控阵检测技术规范
2. **ASTM E2700**: 相控阵超声检测实践指南
3. **ISO 13588**: 超声检测-使用相控阵技术的焊缝检测
4. **EN 16018**: 相控阵超声检测技术应用指南

### 2.2 检测对象分类
基于数据文件命名和实际应用场景：
- **焊缝检测**: 压力容器、管道、结构焊缝的完整性检测
- **分层检测**: 复合材料、多层结构的层间缺陷检测
- **几何形状检测**: 斜坡、台阶等特殊几何形状的检测

### 2.3 数据格式规范
- **帧格式**: FrameID（帧序号）、BeamID（波束序号）
- **采样点**: 896个位置点（Pos1-Pos896）
- **数值范围**: 0-255（8位灰度值）
- **数据类型**: CSV格式，便于导入导出

## 3. 功能需求

### 3.1 核心功能模块

#### 3.1.1 数据展示大屏
**功能描述**: 提供实时、全局的数据监控和展示界面

**核心指标**:
- 实时检测数量统计（今日/本周/本月/总计）
- 检测类型分布（焊缝/分层/其他）
- 缺陷统计分析（合格率、缺陷类型分布）
- 设备状态监控
- 检测人员工作量统计

**可视化组件**:
- 大数字指标卡
- 环形/柱状统计图
- 实时数据流动画
- 地图分布（如适用）
- 趋势折线图

**技术要求**:
- 响应式布局，支持大屏幕展示
- 数据自动刷新（可配置间隔）
- 深色主题，工业风格设计
- 支持全屏展示

#### 3.1.2 数据文件管理
**功能描述**: CSV数据文件的上传、存储、查询和管理

**核心功能**:
- 文件上传
  - 支持CSV格式验证
  - 大文件上传支持（分块上传）
  - 批量上传
  - 拖拽上传
  
- 文件列表
  - 文件名、大小、上传时间、上传人
  - 检测类型标签
  - 搜索和筛选
  - 排序功能
  
- 文件操作
  - 下载原始文件
  - 预览数据
  - 删除（需权限）
  - 导出报告
  
- 元数据管理
  - 检测日期
  - 检测类型（焊缝/分层/斜坡/单层等）
  - 检测人员
  - 样品信息
  - 设备参数
  - 备注说明

**数据解析**:
- 自动解析CSV文件头
- 验证数据格式（FrameID, BeamID, Pos1-896）
- 数据完整性检查
- 异常数据标记

#### 3.1.3 超声图展示页面
**功能描述**: 专业的超声检测图像可视化工具

**可视化类型**:
1. **A扫描(A-Scan)**
   - 时间-幅度曲线
   - 单个超声波束的回波信号
   
2. **B扫描(B-Scan)**
   - 深度-位置截面图
   - 灰度或伪彩色显示
   
3. **C扫描(C-Scan)**
   - 平面投影图
   - 顶视图显示
   
4. **S扫描(S-Scan)**
   - 扇形扫描图
   - 相控阵特有显示方式

**交互功能**:
- 缩放和平移
- 尺标测量
- 缺陷标注
- 对比度调整
- 伪彩色映射选择
- 阈值设置
- 数据导出（图片/PDF）

**算法支持**:
- 图像增强
- 噪声滤波
- 边缘检测
- 缺陷识别（AI辅助）

#### 3.1.4 超声检测试验页面
**功能描述**: 标准化的检测试验流程管理

**试验类型**（基于国际标准）:

1. **焊缝检测试验**
   - 对接焊缝检测
   - 角焊缝检测
   - T型焊缝检测
   - 检测标准: ISO 13588
   
2. **分层检测试验**
   - 单层材料检测
   - 双层/多层材料检测
   - 复合材料分层检测
   - 检测标准: ASTM E2700
   
3. **特殊几何形状检测**
   - 斜坡结构检测
   - 曲面检测
   - 复杂形状检测

**试验流程**:
1. 试验准备
   - 样品信息登记
   - 设备参数设置
   - 耦合剂选择
   - 探头选择
   
2. 试验执行
   - 扫描参数设置
   - 实时数据采集
   - 实时图像显示
   - 异常报警
   
3. 数据记录
   - 自动保存检测数据
   - 关键图像截图
   - 缺陷位置记录
   - 测量数据记录
   
4. 报告生成
   - 检测报告模板
   - 数据统计分析
   - 缺陷评级
   - 结论和建议

**质量控制**:
- 标准试块校准
- 灵敏度校准
- 时间轴校准
- 系统性能验证

### 3.2 辅助功能模块

#### 3.2.1 用户管理
- 用户注册和登录
- 角色权限管理（管理员/检测员/查看者）
- 用户信息管理
- 操作日志

#### 3.2.2 系统设置
- 检测参数配置
- 报警阈值设置
- 显示参数设置
- 数据导出格式设置

#### 3.2.3 帮助文档
- 用户操作手册
- 标准规范引用
- 常见问题解答
- 视频教程

## 4. 非功能需求

### 4.1 性能要求
- **页面加载**: 首屏加载时间 < 2秒
- **数据查询**: 查询响应时间 < 1秒
- **图像渲染**: 大图渲染时间 < 3秒
- **并发用户**: 支持100+并发用户

### 4.2 安全要求
- **数据加密**: 传输加密（HTTPS）、存储加密
- **访问控制**: 基于角色的访问控制（RBAC）
- **数据备份**: 每日自动备份
- **审计日志**: 完整的操作审计记录

### 4.3 可用性要求
- **系统可用性**: 99.5%以上
- **数据可靠性**: 99.99%以上
- **容灾恢复**: RTO < 4小时，RPO < 1小时

### 4.4 兼容性要求
- **浏览器**: Chrome 90+, Firefox 88+, Edge 90+, Safari 14+
- **分辨率**: 最佳1920x1080，最低1366x768
- **移动端**: 响应式设计，支持平板访问

### 4.5 可维护性要求
- **代码规范**: 遵循ESLint标准
- **文档完整**: 代码注释率 > 30%
- **测试覆盖**: 单元测试覆盖率 > 80%
- **模块化**: 组件化、可复用设计

## 5. UI/UX设计要求

### 5.1 设计风格
- **风格定位**: 工业化、科技感、专业化
- **色彩方案**: 
  - 主色: 深蓝色（#1a2332）
  - 辅色: 科技蓝（#00a8ff）
  - 强调色: 橙色（#ff6b35）
  - 成功: 绿色（#26de81）
  - 警告: 黄色（#fed330）
  - 危险: 红色（#fc5c65）

### 5.2 布局规范
- **导航栏**: 顶部导航，固定显示
- **侧边栏**: 左侧功能菜单（可折叠）
- **主内容区**: 自适应布局
- **信息展示**: 卡片式设计

### 5.3 交互规范
- **响应速度**: 操作即时反馈
- **加载状态**: 明确的加载指示
- **错误提示**: 友好的错误提示信息
- **操作引导**: 关键操作提供引导

### 5.4 数据可视化
- **图表类型**: 使用专业的可视化库（ECharts/D3.js）
- **配色方案**: 清晰的对比度，色盲友好
- **动画效果**: 流畅但不过度的动画
- **响应式**: 图表自适应容器大小

## 6. 技术架构

### 6.1 技术栈
- **前端框架**: Astro (SSG/SSR混合模式)
- **UI框架**: React + Tailwind CSS
- **后端服务**: Supabase (PostgreSQL + Auth + Storage + Realtime)
- **部署平台**: Netlify
- **可视化库**: ECharts / D3.js / Three.js
- **状态管理**: React Context API / Zustand
- **数据请求**: Supabase Client SDK

### 6.2 数据流架构
```
用户 → 前端界面(Astro/React) → Supabase API → PostgreSQL
                ↓
          Supabase Storage (CSV文件存储)
                ↓
          数据解析和可视化
```

### 6.3 安全架构
- **认证**: Supabase Auth (Email/OAuth)
- **授权**: Row Level Security (RLS) Policies
- **数据加密**: PostgreSQL加密 + HTTPS传输
- **API保护**: Supabase API Keys + RLS

## 7. 数据模型

### 7.1 核心数据表

#### 7.1.1 users (用户表)
```sql
- id: UUID (主键)
- email: STRING (唯一)
- full_name: STRING
- role: ENUM (admin, engineer, viewer)
- created_at: TIMESTAMP
- updated_at: TIMESTAMP
```

#### 7.1.2 ultrasonic_files (文件表)
```sql
- id: UUID (主键)
- file_name: STRING
- file_size: INTEGER
- file_path: STRING (Supabase Storage路径)
- upload_user_id: UUID (外键 → users.id)
- upload_time: TIMESTAMP
- detection_type: ENUM (weld, layered, slope, single_layer)
- specimen_info: JSONB
- device_params: JSONB
- status: ENUM (uploaded, processing, processed, error)
- created_at: TIMESTAMP
- updated_at: TIMESTAMP
```

#### 7.1.3 detection_data (检测数据表)
```sql
- id: UUID (主键)
- file_id: UUID (外键 → ultrasonic_files.id)
- frame_id: INTEGER
- beam_id: INTEGER
- position_data: JSONB (Pos1-Pos896数据)
- max_amplitude: FLOAT
- defect_detected: BOOLEAN
- defect_position: JSONB
- created_at: TIMESTAMP
```

#### 7.1.4 experiments (试验表)
```sql
- id: UUID (主键)
- experiment_name: STRING
- experiment_type: ENUM (weld, layered, special)
- standard_reference: STRING (ISO/ASTM标准编号)
- operator_id: UUID (外键 → users.id)
- specimen_info: JSONB
- device_params: JSONB
- calibration_data: JSONB
- start_time: TIMESTAMP
- end_time: TIMESTAMP
- status: ENUM (preparing, in_progress, completed, failed)
- created_at: TIMESTAMP
- updated_at: TIMESTAMP
```

#### 7.1.5 experiment_results (试验结果表)
```sql
- id: UUID (主键)
- experiment_id: UUID (外键 → experiments.id)
- file_id: UUID (外键 → ultrasonic_files.id)
- defect_count: INTEGER
- defect_details: JSONB
- quality_grade: ENUM (A, B, C, D, reject)
- conclusion: TEXT
- report_path: STRING
- created_at: TIMESTAMP
```

#### 7.1.6 audit_logs (审计日志表)
```sql
- id: UUID (主键)
- user_id: UUID (外键 → users.id)
- action: STRING
- resource_type: STRING
- resource_id: UUID
- details: JSONB
- ip_address: STRING
- created_at: TIMESTAMP
```

### 7.2 数据关系
- 一个用户可以上传多个文件
- 一个文件包含多条检测数据
- 一个试验可以关联多个文件
- 一个试验对应一个试验结果

## 8. 开发计划

### 8.1 开发阶段
1. **第一阶段 (1-2天)**: 需求调研、文档编制、数据库设计
2. **第二阶段 (3-5天)**: 核心功能开发（数据管理、文件上传）
3. **第三阶段 (6-8天)**: 可视化功能开发（大屏、超声图）
4. **第四阶段 (9-10天)**: 试验流程开发、测试和优化
5. **第五阶段 (11-12天)**: 部署和上线

### 8.2 里程碑
- **M1**: PRD和技术文档完成
- **M2**: 数据库和基础架构完成
- **M3**: 核心功能MVP完成
- **M4**: 完整功能开发完成
- **M5**: 测试通过，正式上线

## 9. 测试计划

### 9.1 测试类型
- **单元测试**: 关键函数和组件
- **集成测试**: API接口和数据流
- **功能测试**: 完整业务流程
- **性能测试**: 大数据量和并发
- **安全测试**: 权限和数据安全
- **兼容性测试**: 多浏览器和设备

### 9.2 测试用例
详见独立的测试用例文档

## 10. 风险与应对

### 10.1 技术风险
- **风险**: 大数据量CSV解析性能问题
- **应对**: 使用Web Worker后台解析，分批处理

- **风险**: 复杂图像渲染性能问题
- **应对**: Canvas/WebGL加速，图像分块渲染

### 10.2 业务风险
- **风险**: 用户对标准不熟悉
- **应对**: 提供详细的帮助文档和标准引用

- **风险**: 数据安全问题
- **应对**: 严格的权限控制和加密措施

## 11. 未来规划

### 11.1 短期规划 (3个月内)
- 移动端APP开发
- 离线数据采集功能
- AI缺陷识别

### 11.2 中期规划 (6个月内)
- 3D可视化
- 实时协作功能
- 高级数据分析

### 11.3 长期规划 (1年内)
- 多站点部署
- 设备集成
- 行业解决方案

## 12. 附录

### 12.1 术语表
- **超声检测**: 利用超声波在材料中传播特性进行无损检测
- **相控阵**: 通过控制多个探头单元的发射时序实现波束偏转和聚焦
- **A扫描**: 单点超声检测的时间-幅度显示
- **B扫描**: 深度-位置的二维剖面显示
- **C扫描**: 平面投影的俯视图显示
- **RLS**: Row Level Security，行级安全策略

### 12.2 参考文献
1. ISO 16810:2014 - 超声相控阵检测技术
2. ASTM E2700 - 相控阵超声检测实践标准指南
3. ISO 13588:2018 - 焊缝相控阵超声检测
4. EN 16018:2011 - 相控阵超声检测方法

### 12.3 更新日志
- 2025-10-03: v1.0 初始版本发布

