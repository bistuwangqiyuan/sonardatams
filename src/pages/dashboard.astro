---
/**
 * æ•°æ®å±•ç¤ºå¤§å±é¡µé¢
 */
import Layout from '@/layouts/Layout.astro';
import { Header } from '@/components/layout/Header';
---

<Layout title="æ•°æ®å¤§å± - è¶…å£°æ•°æ®ç®¡ç†ç³»ç»Ÿ">
  <Header currentPath="/dashboard" client:load />
  
  <main class="min-h-screen bg-primary-900 py-8">
    <div class="container mx-auto px-4">
      <!-- Page Header -->
      <div class="mb-8">
        <h1 class="text-3xl font-bold text-white mb-2">æ•°æ®å±•ç¤ºå¤§å±</h1>
        <p class="text-gray-400">å®æ—¶ç›‘æ§æ£€æµ‹æ•°æ®ï¼Œå¤šç»´åº¦ç»Ÿè®¡åˆ†æ</p>
      </div>

      <!-- Key Metrics -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <!-- Metric Card 1 -->
        <div class="card">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-400 text-sm mb-1">æ€»æ£€æµ‹æ–‡ä»¶</p>
              <p class="text-3xl font-bold text-white">1,234</p>
              <p class="text-success text-sm mt-1">â†‘ 12.5% æœ¬æœˆ</p>
            </div>
            <div class="w-16 h-16 bg-secondary/20 rounded-full flex items-center justify-center">
              <span class="text-3xl">ğŸ“</span>
            </div>
          </div>
        </div>

        <!-- Metric Card 2 -->
        <div class="card">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-400 text-sm mb-1">ä»Šæ—¥æ£€æµ‹</p>
              <p class="text-3xl font-bold text-white">45</p>
              <p class="text-success text-sm mt-1">å®æ—¶æ›´æ–°</p>
            </div>
            <div class="w-16 h-16 bg-accent/20 rounded-full flex items-center justify-center">
              <span class="text-3xl">ğŸ“Š</span>
            </div>
          </div>
        </div>

        <!-- Metric Card 3 -->
        <div class="card">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-400 text-sm mb-1">ç¼ºé™·æ£€å‡º</p>
              <p class="text-3xl font-bold text-white">89</p>
              <p class="text-warning text-sm mt-1">éœ€å…³æ³¨</p>
            </div>
            <div class="w-16 h-16 bg-warning/20 rounded-full flex items-center justify-center">
              <span class="text-3xl">âš ï¸</span>
            </div>
          </div>
        </div>

        <!-- Metric Card 4 -->
        <div class="card">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-400 text-sm mb-1">åˆæ ¼ç‡</p>
              <p class="text-3xl font-bold text-white">95.6%</p>
              <p class="text-success text-sm mt-1">â†‘ 2.3%</p>
            </div>
            <div class="w-16 h-16 bg-success/20 rounded-full flex items-center justify-center">
              <span class="text-3xl">âœ“</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Row 1 -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <!-- Detection Type Distribution -->
        <div class="card">
          <h3 class="text-xl font-bold text-white mb-4">æ£€æµ‹ç±»å‹åˆ†å¸ƒ</h3>
          <div id="detectionTypeChart" class="h-80"></div>
        </div>

        <!-- Quality Grade Distribution -->
        <div class="card">
          <h3 class="text-xl font-bold text-white mb-4">è´¨é‡ç­‰çº§åˆ†å¸ƒ</h3>
          <div id="qualityGradeChart" class="h-80"></div>
        </div>
      </div>

      <!-- Charts Row 2 -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <!-- Trend Chart -->
        <div class="card">
          <h3 class="text-xl font-bold text-white mb-4">æ£€æµ‹è¶‹åŠ¿ï¼ˆè¿‘30å¤©ï¼‰</h3>
          <div id="trendChart" class="h-80"></div>
        </div>

        <!-- Defect Statistics -->
        <div class="card">
          <h3 class="text-xl font-bold text-white mb-4">ç¼ºé™·ç»Ÿè®¡</h3>
          <div id="defectChart" class="h-80"></div>
        </div>
      </div>

      <!-- Recent Files Table -->
      <div class="card">
        <h3 class="text-xl font-bold text-white mb-4">æœ€è¿‘æ£€æµ‹æ–‡ä»¶</h3>
        <div class="overflow-x-auto">
          <table class="table">
            <thead>
              <tr>
                <th>æ–‡ä»¶å</th>
                <th>æ£€æµ‹ç±»å‹</th>
                <th>çŠ¶æ€</th>
                <th>ç¼ºé™·æ•°</th>
                <th>è´¨é‡ç­‰çº§</th>
                <th>ä¸Šä¼ æ—¶é—´</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="font-medium">1-ç„Šç¼.csv</td>
                <td><span class="badge badge-info">ç„Šç¼æ£€æµ‹</span></td>
                <td><span class="badge badge-success">å·²å¤„ç†</span></td>
                <td>5</td>
                <td><span class="badge badge-success">Açº§</span></td>
                <td>2å°æ—¶å‰</td>
              </tr>
              <tr>
                <td class="font-medium">2-åŒå±‚-3.csv</td>
                <td><span class="badge badge-info">åˆ†å±‚æ£€æµ‹</span></td>
                <td><span class="badge badge-success">å·²å¤„ç†</span></td>
                <td>3</td>
                <td><span class="badge badge-success">Bçº§</span></td>
                <td>4å°æ—¶å‰</td>
              </tr>
              <tr>
                <td class="font-medium">2-æ–œå¡.csv</td>
                <td><span class="badge badge-info">æ–œå¡æ£€æµ‹</span></td>
                <td><span class="badge badge-success">å·²å¤„ç†</span></td>
                <td>8</td>
                <td><span class="badge badge-warning">Cçº§</span></td>
                <td>6å°æ—¶å‰</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </main>
</Layout>

<script>
  // æ¨¡æ‹Ÿå›¾è¡¨æ•°æ®ï¼ˆå®é™…åº”ä»APIè·å–ï¼‰
  import * as echarts from 'echarts';

  // æ£€æµ‹ç±»å‹åˆ†å¸ƒ
  const detectionTypeChart = echarts.init(document.getElementById('detectionTypeChart'));
  detectionTypeChart.setOption({
    backgroundColor: 'transparent',
    tooltip: { trigger: 'item' },
    legend: {
      orient: 'vertical',
      left: 'left',
      textStyle: { color: '#9ca3af' }
    },
    series: [{
      type: 'pie',
      radius: ['40%', '70%'],
      data: [
        { value: 548, name: 'ç„Šç¼æ£€æµ‹' },
        { value: 335, name: 'åˆ†å±‚æ£€æµ‹' },
        { value: 234, name: 'æ–œå¡æ£€æµ‹' },
        { value: 117, name: 'å•å±‚æ£€æµ‹' }
      ],
      emphasis: {
        itemStyle: {
          shadowBlur: 10,
          shadowOffsetX: 0,
          shadowColor: 'rgba(0, 0, 0, 0.5)'
        }
      },
      label: { color: '#9ca3af' }
    }]
  });

  // è´¨é‡ç­‰çº§åˆ†å¸ƒ
  const qualityGradeChart = echarts.init(document.getElementById('qualityGradeChart'));
  qualityGradeChart.setOption({
    backgroundColor: 'transparent',
    tooltip: { trigger: 'axis', axisPointer: { type: 'shadow' } },
    xAxis: {
      type: 'category',
      data: ['Açº§', 'Bçº§', 'Cçº§', 'Dçº§', 'ä¸åˆæ ¼'],
      axisLabel: { color: '#9ca3af' }
    },
    yAxis: {
      type: 'value',
      axisLabel: { color: '#9ca3af' }
    },
    series: [{
      data: [520, 380, 234, 78, 22],
      type: 'bar',
      itemStyle: {
        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
          { offset: 0, color: '#00a8ff' },
          { offset: 1, color: '#0086cc' }
        ])
      }
    }]
  });

  // è¶‹åŠ¿å›¾
  const trendChart = echarts.init(document.getElementById('trendChart'));
  const dates = Array.from({length: 30}, (_, i) => {
    const d = new Date();
    d.setDate(d.getDate() - 29 + i);
    return `${d.getMonth() + 1}/${d.getDate()}`;
  });
  trendChart.setOption({
    backgroundColor: 'transparent',
    tooltip: { trigger: 'axis' },
    xAxis: {
      type: 'category',
      data: dates,
      axisLabel: { color: '#9ca3af' }
    },
    yAxis: {
      type: 'value',
      axisLabel: { color: '#9ca3af' }
    },
    series: [{
      data: Array.from({length: 30}, () => Math.floor(Math.random() * 50) + 20),
      type: 'line',
      smooth: true,
      areaStyle: {
        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
          { offset: 0, color: 'rgba(0, 168, 255, 0.3)' },
          { offset: 1, color: 'rgba(0, 168, 255, 0)' }
        ])
      },
      lineStyle: { color: '#00a8ff' }
    }]
  });

  // ç¼ºé™·ç»Ÿè®¡
  const defectChart = echarts.init(document.getElementById('defectChart'));
  defectChart.setOption({
    backgroundColor: 'transparent',
    tooltip: { trigger: 'axis' },
    xAxis: {
      type: 'category',
      data: ['è£‚çº¹', 'æ°”å­”', 'å¤¹æ‚', 'æœªç†”åˆ', 'å…¶ä»–'],
      axisLabel: { color: '#9ca3af' }
    },
    yAxis: {
      type: 'value',
      axisLabel: { color: '#9ca3af' }
    },
    series: [{
      data: [35, 28, 15, 8, 3],
      type: 'bar',
      itemStyle: { color: '#ff6b35' }
    }]
  });

  // å“åº”å¼è°ƒæ•´
  window.addEventListener('resize', () => {
    detectionTypeChart.resize();
    qualityGradeChart.resize();
    trendChart.resize();
    defectChart.resize();
  });
</script>

